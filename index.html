import React, { useState, useEffect } from 'react';
import { Apple, Dumbbell, Zap, ChevronDown, List, X, Gauge, Soup, MessageSquare, Send, Loader, Brain, Goal, Target, Heart, Activity } from 'lucide-react';

// Mock Icon Mapping (Must be defined outside components)
const Icon = ({ name, className }) => {
  // ADDED ACTIVITY to the icons list
  const icons = { Apple, Dumbbell, Zap, ChevronDown, List, X, Gauge, Soup, MessageSquare, Send, Loader, Brain, Goal, Target, Heart, Activity };
  // Fallback to a safe icon (Zap) if the name doesn't match
  const LucideIcon = icons[name] || Zap; 
  return <LucideIcon className={className} />;
};

// --- MARKDOWN RENDERING UTILITY ---
const renderMarkdown = (text) => {
  if (!text) return null;
  
  // Split the text by the bold markers (**...**) while keeping the markers
  const parts = text.split(/(\*\*.*?\*\*)/g);

  return parts.map((part, index) => {
    if (part.startsWith('**') && part.endsWith('**')) {
      // It's a bolded segment: remove the asterisks and wrap in <strong>
      const boldText = part.slice(2, part.length - 2).trim(); // Corrected slice logic
      // Use Tailwind class 'font-bold text-gray-900' for rendering
      return <strong key={index} className="font-bold text-gray-900">{boldText}</strong>;
    }
    // It's a standard text segment
    return part;
  });
};


// --- CORE KNOWLEDGE DATA ---

// MONOCHROME THEME VARIABLES
const ACCENT_COLOR = 'text-black';
const ACCENT_CLASS = 'bg-black hover:bg-gray-800';

const knowledgeSections = [
  {
    id: 'home',
    title: 'Home / Performance Overview',
    icon: 'Activity', // ICON CHANGED FROM 'Goal' TO 'Activity'
    color: ACCENT_COLOR,
    content: null, // Home uses a dedicated component
  },
  {
    id: 'ai-brain',
    title: 'Gymini: AI Coaching Brain', // UPDATED TITLE HERE
    icon: 'Brain',
    color: ACCENT_COLOR, // UPDATED COLOR FOR PROMINENCE
    content: null, // AI section uses a dedicated component
  },
  {
    id: 'nutrition',
    title: 'Nutrition & Fueling',
    icon: 'Apple',
    color: 'text-gray-700',
    content: [
      {
        title: 'Calorie Balance: The Simple Math of Weight Change',
        body: 'Whether you gain, lose, or maintain weight comes down to one fundamental principle: **Energy Balance** (Calories In vs. Calories Out). Everything else is secondary.\n\nThe "Calories Out" side is called your **Total Daily Energy Expenditure (TDEE)**. It’s the total energy your body burns every day, which is made up of four main factors:\n\n1. **Resting Metabolism (BMR):** Energy used for basic survival (breathing, circulating blood). This is the biggest factor.\n2. **Digesting Food (TEF):** Energy used to process the food you eat. **Protein requires the most energy to digest,** which is one reason it’s great for weight loss.\n3. **Daily Movement (NEAT):** Energy from non-exercise activity like walking, standing, and fidgeting. This is highly variable and often the biggest difference between two people\'s daily burn.\n4. **Workouts (EAT):** Calories burned during structured exercise.\n\nTo achieve **Fat Loss**, you need a consistent **Calorie Deficit** (eating slightly fewer calories than your TDEE). To achieve **Muscle Gain**, you need a small **Calorie Surplus** (eating slightly more than your TDEE). '
      },
      {
        title: 'Protein: The Building Block for Muscle and Fullness',
        body: 'Protein is the most important nutrient for changing your body shape. It provides the **amino acids** (tiny building blocks) your body needs to repair and build muscle tissue after training. It also has the biggest impact on **satiety** (feeling full).\n\n**The \'Per Meal\' Rule:** To maximize muscle repair and growth, you need to hit a certain amount of protein in a single sitting to send a strong signal to your body. Aim for **25–30 grams of high-quality protein** at most meals.\n\n**Daily Goal:** Most people do well aiming for **0.8 to 1 gram of protein per pound of your GOAL body weight**. Spreading this intake across **4–5 meals/snacks** throughout the day is the best strategy to keep your body in a repair and growth state, and most importantly, keep you feeling satisfied.'
      },
      {
        title: 'Carbohydrates: Your Fast-Burning Energy Fuel',
        body: 'Carbohydrates are your body’s preferred source of fast energy, especially for intense activities like strength training or sprinting. Carbs are stored in your muscles and liver as **Glycogen**, which is like a rapid-response battery.\n\n1. **Workout Fuel:** Glycogen directly fuels your hard lifting sets. If your glycogen is low, your strength and ability to do work will drop off fast.\n2. **Fiber:** Carbs are also the source of **Fiber**, which is essential for a healthy gut and keeping you full.\n\n**Strategy:** Focus on **Complex Carbohydrates** (oats, whole grains, root vegetables) for sustained energy, and time simple, fast-absorbing carbs (e.g., fruit, white rice) **after your workout** to quickly refuel and start the recovery process.'
      },
      {
        title: 'Dietary Fats: Essential for Hormones and Health',
        body: 'Fats are vital for your overall health, but they are very calorie-dense (9 calories per gram vs. 4 for protein/carbs), so they must be tracked carefully. Their key roles are:\n\n1. **Hormone Balance:** Fats provide the raw material your body needs to create crucial hormones like **Testosterone and Estrogen**. Consuming too little fat can harm hormone production, affecting recovery, mood, and energy levels.\n2. **Vitamin Absorption:** You need fat to properly absorb the fat-soluble vitamins: **A, D, E, and K**.\n\nFocus on sources of **healthy fats**—like those containing Omega-3s (found in fatty fish, nuts, seeds, avocados)—which help manage inflammation. Aim for roughly **20–30% of your total daily calories** from quality fat sources.'
      },
      {
        title: 'Fiber, Satiety, and Gut Health',
        body: 'Fiber—found in vegetables, fruits, and whole grains—is crucial for appetite control and long-term health. Aim for **25–35 grams per day**.\n\n1. **The Fullness Factor:** Fiber adds volume to your food with almost no calories. It slows down digestion, which helps you feel full for longer and manage cravings.\n2. **Gut Support:** Fiber acts as a **prebiotic**, which means it feeds the beneficial bacteria in your gut. A healthy gut is linked to better immunity, improved nutrient absorption, and even mood stability.\n\n* **Soluble Fiber:** (Oats, beans) Forms a gel that helps stabilize blood sugar.\n* **Insoluble Fiber:** (Vegetable skins, whole grains) Adds bulk to stool, promoting regular digestion.'
      },
      {
        title: 'Hydration and Electrolytes: Preventing the Energy Crash',
        body: 'Even mild dehydration dramatically impacts both physical and mental performance. Losing just **2% of your body weight in water** can reduce your strength, endurance, and concentration.\n\n**Electrolytes** (like Sodium, Potassium, Magnesium) are critical minerals that help your body transmit nerve signals, contract muscles, and maintain the right fluid balance in your cells. When you sweat a lot, you lose sodium, which can lead to cramping and fatigue.\n\n**Goal:** Drink at least **3.0 to 4.0 liters of water** daily, and consider adding an electrolyte source if your workouts are long (over 90 minutes) or you are training in the heat.'
      },
      {
        title: 'Nutrient Timing: Fueling Around Workouts',
        body: 'While you don\'t need to rush immediately after your last set, the 1–3 hours after training is still important for jump-starting the recovery process.\n\n**Post-Workout Goals (0–3 Hours):**\n1. **Refuel:** Eat fast-digesting carbohydrates (e.g., a banana, rice, or juice) to quickly restock your muscle energy stores (**glycogen**).\n2. **Repair:** Consume 25–30g of protein (like a whey shake or chicken breast) to signal your muscles to begin the repair and growth process.\n\nMaking this a priority stops the breakdown signals from hard training and ensures you recover faster for your next session.'
      },
      {
        title: 'The 80/20 Rule: Flexibility and Sustainability',
        body: 'The most effective diet is the one you can stick to forever. An overly restrictive plan is a fast track to burnout and failure. This is where the **80/20 Rule** comes in:\n\n* **80% of your intake** comes from nutrient-dense, whole, unprocessed foods that support your goals (lean proteins, vegetables, whole grains).\n* **20% of your intake** is reserved for flexibility—social eating, treats, or favorite foods that simply make life enjoyable.\n\nThis simple approach helps manage the stress that often comes from dieting. Constant, intense restriction can raise your stress hormone, **Cortisol**, which paradoxically can interfere with fat loss and make cravings worse. The 80/20 Rule removes this pressure.'
      },
      // --- NEW NUTRITION ARTICLES (7) ---
      {
        title: 'Water Weight vs. True Fat Loss',
        body: 'One of the most frustrating aspects of fitness is the scale not moving, or even going up, despite feeling like you\'re doing everything right. This is almost always due to **water weight fluctuations**, not actual fat gain.\n\n**Common Causes of Water Retention:**\n1. **High Sodium Intake:** Eating salty foods (especially restaurant meals) causes your body to hold extra water to dilute the sodium.\n2. **Carbohydrate Intake:** Every gram of glycogen (stored carbs) binds with about **3 grams of water** in your muscle. Starting a new, heavy training block or having a high-carb meal will temporarily raise the scale.\n3. **High Stress/Poor Sleep:** Elevated **cortisol** can cause water retention.\n4. **Menstrual Cycle:** Hormone shifts cause significant fluid retention in women.\n\n**The Solution:** Look at the **long-term trend** (weekly averages), not the daily number. Trust the process, track your measurements, and focus on non-scale victories (NSVs).'
      },
      {
        title: 'A Quick Guide to Supplements: Creatine and Whey',
        body: 'Supplements are the 1% that follows the 99% of hard work, good nutrition, and sleep. Two are widely regarded as safe and effective:\n\n1. **Creatine Monohydrate:** This is the most studied and effective supplement. It helps your body recycle the quick energy source (**ATP**) used during explosive movements (heavy lifts, sprints). **Result:** Allows you to squeeze out 1-2 extra reps, leading to faster strength and muscle gains. **Dosage:** 3-5 grams daily, indefinitely.\n2. **Whey Protein:** A fast-digesting, convenient source of high-quality protein. It\'s a food source, not a magic pill. **Use:** Best post-workout or as an easy snack to ensure you hit your daily protein goal. It offers no advantage over whole-food protein if you can hit your targets naturally.'
      },
      {
        title: 'Dealing with Cravings and Managing Hunger',
        body: 'Cravings are normal, but learning to manage them is key to consistency. They are often driven by habit, stress, or blood sugar dips, not actual physical need.\n\n**Curbing Strategies:**\n1. **Increase Protein & Fiber:** These are the most satiating nutrients. Ensure your last meal had a large portion of protein and vegetables.\n2. **Hydration First:** Often, the brain mistakes thirst for hunger. Drink a large glass of water and wait 15 minutes.\n3. **Use Distraction:** Engage in a short, focused task (read a chapter, answer emails, take a quick walk). Cravings typically peak and pass within 20 minutes.\n4. **Pre-Planned Treat:** If you need a treat, make it a controlled, pre-planned portion (part of your 20% flexibility) rather than an uncontrolled binge.'
      },
      {
        title: 'The Impact of Alcohol on Fitness Goals',
        body: 'Alcohol consumption can directly hinder muscle gain and fat loss through several metabolic pathways. It is best minimized or avoided during intense goal phases.\n\n1. **"Empty" Calories:** Alcohol contains **7 calories per gram** with zero nutritional value. These calories add up quickly and are often accompanied by mixers or high-calorie snacks.\n2. **Hormonal Disruption:** Alcohol temporarily lowers **Testosterone** (a muscle-building hormone) and can raise **Cortisol** (a stress hormone), making muscle repair less efficient.\n3. **Sleep Quality:** Even if you fall asleep faster, alcohol severely degrades the quality of your deep and REM sleep cycles, which are vital for physical recovery and cognitive function.'
      },
      {
        title: 'How to Read a Nutrition Label Quickly',
        body: 'Knowing what to look for allows you to make informed decisions quickly in the supermarket:\n\n1. **Serving Size:** **Always** check this first. Labels list nutrients *per serving*, not per container. If you eat the whole box, you must multiply everything.\n2. **Protein Count:** Is it meeting the 25–30g per serving goal? Look for a high protein-to-calorie ratio.\n3. **Fiber:** Aim for foods that offer **3+ grams of Fiber per serving** to ensure gut health and satiety.\n4. **Ingredient List:** Look at the first three ingredients. They make up the largest portion of the food. If sugar, white flour, or processed oils are at the top, it\'s likely a low-nutrient food.'
      },
      {
        title: 'The Importance of Micronutrients (Vitamins & Minerals)',
        body: '**Micronutrients** (vitamins and minerals) are essential, non-caloric nutrients that drive every metabolic process in your body. While they don\'t contain energy, they are needed to **extract** energy from the macronutrients (protein, carbs, fat).\n\n* **Iron:** Crucial for transporting oxygen in the blood—vital for endurance.\n* **Vitamin D:** Essential for hormone production, immunity, and calcium absorption (bone health).\n* **Magnesium:** Involved in over 300 enzyme reactions, including muscle contraction, nervous system function, and sleep quality.\n\n**Strategy:** The best way to get all your required micros is by eating a high volume of **colorful vegetables and diverse whole foods**. Supplementation should only fill known gaps, not replace a poor diet.'
      },
      {
        title: 'Mastering the Meal Prep Strategy',
        body: 'Meal prepping is the single greatest time-saver and compliance tool in fitness. It removes the stress of daily food decisions and ensures you always have a healthy option ready when hunger hits.\n\n**The Three-Step Prep:**\n1. **The Protein Cook:** Cook large batches of 2-3 lean proteins (e.g., chicken breast, ground turkey, or hard-boiled eggs).\n2. **The Carb/Fiber Prep:** Prepare bulk sides of slow-digesting carbs and vegetables (e.g., quinoa, sweet potato, roasted broccoli/asparagus).\n3. **The Assembly/Storage:** Use stackable containers to portion out 3–4 days of meals. Store ready-to-eat portions (like fruit or yogurt) separately for easy access.\n\n**Goal:** Reduce decision fatigue. The fewer times you have to decide what to eat when hungry, the more likely you are to stick to your plan.'
      },
    ]
  },
  {
    id: 'recipes',
    title: 'Recipe Ideas (High-Protein)',
    icon: 'Soup',
    color: 'text-gray-700',
    content: [
      {
        title: 'Overnight Protein Oats (1 Serving)',
        body: `
          **Ingredients:**
          - 1/2 cup (40g) Rolled Oats
          - 1 scoop (30g) Vanilla/Chocolate Protein Powder
          - 1 cup (240ml) Unsweetened Almond Milk
          - 1 tbsp (15g) Chia Seeds
          - Optional toppings: 1/2 cup berries (70g), dash of Cinnamon.

          **Instructions:**
          1. Combine all ingredients in a jar or container.
          2. Stir well until the protein powder is fully dissolved and there are no clumps.
          3. Seal and refrigerate for at least 6 hours, or overnight.
          4. Top with berries before serving.

          **Macros (Approximate, without optional toppings):**
          - Calories: 320 kcal
          - Protein: 40g
          - Carbs: 25g
          - Fat: 7g
        `
      },
      {
        title: 'Simple High-Protein Scramble (1 Serving)',
        body: `
          **Ingredients:**
          - 3 large Eggs
          - 2 large Egg Whites (60g)
          - 1/4 cup (30g) diced Bell Peppers
          - 1/4 cup (30g) Spinach
          - 1/4 cup (30g) Low-Fat Cottage Cheese or Feta
          - Seasoning (salt, pepper, paprika).

          **Instructions:**
          1. Whisk eggs and egg whites with salt and pepper.
          2. Spray a non-stick pan with cooking spray and sauté the peppers until soft.
          3. Add spinach until wilted.
          4. Pour egg mixture over vegetables. Scramble until almost set, then stir in cottage cheese/feta.

          **Macros (Approximate):**
          - Calories: 280 kcal
          - Protein: 30g
          - Carbs: 6g
          - Fat: 15g
        `
      },
      {
        title: 'Lean Turkey & Veggie Stir-fry (2 Servings)',
        body: `
          **Ingredients:**
          - 1 lb (450g) Lean Ground Turkey (93/7 or leaner)
          - 1 tbsp Soy Sauce (low sodium)
          - 1 tbsp Ginger (minced)
          - 1 head Broccoli (cut into florets)
          - 2 cups mixed stir-fry vegetables (carrots, snap peas, cabbage)
          - 1/4 cup Chicken Broth.

          **Instructions:**
          1. Brown the ground turkey in a large pan and drain excess fat.
          2. Add ginger and stir-fry vegetables (except broccoli). Cook for 5 minutes.
          3. Add broccoli, soy sauce, and broth. Cover and steam for 3-5 minutes until broccoli is tender-crisp.
          4. Serve hot, optionally over 1/2 cup of brown rice per serving (macros below do not include rice).

          **Macros (Approximate, per serving):**
          - Calories: 380 kcal
          - Protein: 45g
          - Carbs: 20g
          - Fat: 14g
        `
      },
      {
        title: 'Tuna Salad Lettuce Wraps (1 Serving)',
        body: `
          **Ingredients:**
          - 1 can (142g) Tuna in water (drained)
          - 2 tbsp (30g) Plain Greek Yogurt (0% fat)
          - 1 tbsp (15g) finely diced Celery
          - 1 tsp Dijon Mustard
          - Salt, pepper, dash of lemon juice.
          - 4 large Romaine or Butter Lettuce leaves.

          **Instructions:**
          1. Flake the tuna into a bowl.
          2. Add Greek yogurt, celery, mustard, salt, pepper, and lemon juice. Mix well.
          3. Spoon the mixture into the lettuce leaves.

          **Macros (Approximate):**
          - Calories: 170 kcal
          - Protein: 30g
          - Carbs: 5g
          - Fat: 3g
        `
      },
      {
        title: 'Simple Baked Chicken Breast (4 Servings)',
        body: `
          **Ingredients:**
          - 4 medium (180g each) Boneless, Skinless Chicken Breasts
          - 1 tbsp Olive Oil (for brushing)
          - 1 tsp Garlic Powder
          - 1 tsp Paprika
          - 1/2 tsp Salt, 1/4 tsp Pepper.

          **Instructions:**
          1. Preheat oven to 400°F (200°C).
          2. Pat chicken dry. Brush lightly with olive oil and sprinkle generously with spices.
          3. Bake for 20-25 minutes, or until the internal temperature reaches 165°F (74°C). This is ideal for meal prep.

          **Macros (Approximate, per serving):**
          - Calories: 240 kcal
          - Protein: 45g
          - Carbs: 0g
          - Fat: 6g
        `
      },
      {
        title: 'Quick Protein Smoothie (1 Serving)',
        body: `
          **Ingredients:**
          - 1 scoop (30g) Protein Powder (any flavor)
          - 1 cup (240ml) Water or Unsweetened Almond Milk
          - 1/2 cup (70g) Frozen Berries
          - 1/2 medium Frozen Banana
          - 1 tbsp (15g) Spinach (you won't taste it!)

          **Instructions:**
          1. Add liquid and protein powder to a blender. Blend until smooth.
          2. Add frozen fruits and spinach. Blend until thick and smooth. Add more water if needed for desired consistency.

          **Macros (Approximate, using water):**
          - Calories: 250 kcal
          - Protein: 35g
          - Carbs: 25g
          - Fat: 3g
        `
      },
      {
        title: 'High-Fiber Lentil Soup (6 Servings)',
        body: `
          **Ingredients:**
          - 1 tbsp Olive Oil
          - 1 medium Onion (diced)
          - 2 Carrots, 2 Celery stalks (diced)
          - 1 cup (200g) Brown or Green Lentils
          - 6 cups (1.4L) Vegetable or Chicken Broth
          - 1 can (400g) Diced Tomatoes
          - Seasoning (Bay leaf, Thyme, Salt, Pepper).

          **Instructions:**
          1. Sauté onion, carrots, and celery in olive oil until soft.
          2. Add lentils, broth, tomatoes, and seasoning.
          3. Bring to a boil, then reduce heat and simmer covered for 30-40 minutes, or until lentils are tender.

          **Macros (Approximate, per serving):**
          - Calories: 220 kcal
          - Protein: 14g
          - Carbs: 34g
          - Fat: 4g
        `
      },
      {
        title: 'Low-Calorie Chicken & Black Bean Salad (1 Serving)',
        body: `
          **Ingredients:**
          - 4 oz (115g) Pre-cooked Chicken Breast (shredded or diced)
          - 1/2 cup (120g) Black Beans (rinsed)
          - 1/4 cup Corn
          - 1/4 cup (30g) Red Onion (diced)
          - Dressing: 1 tbsp Olive Oil, 1 tbsp Lime Juice, Cumin, Salt, Pepper.

          **Instructions:**
          1. Combine all salad ingredients in a large bowl.
          2. Whisk together all dressing ingredients in a small bowl.
          3. Toss the salad with the dressing until everything is well coated.

          **Macros (Approximate):**
          - Calories: 370 kcal
          - Protein: 38g
          - Carbs: 30g
          - Fat: 12g
        `
      },
      {
        title: 'Protein Pudding Dessert (1 Serving)',
        body: `
          **Ingredients:**
          - 1 cup (240g) Plain Greek Yogurt (0% fat)
          - 1 scoop (30g) Casein Protein Powder (Chocolate or Vanilla works best)
          - 2 tbsp (30ml) Water or Almond Milk
          - Optional toppings: 1 tsp Cocoa Powder, Stevia, 1/4 cup Cherries.

          **Instructions:**
          1. Mix the casein powder and water/almond milk in a small bowl until a thick paste forms (casein is thicker than whey).
          2. Stir in the Greek yogurt and any other flavorings/sweeteners until completely smooth and creamy.
          3. Refrigerate for 15 minutes to firm up slightly. Enjoy as a nightly protein hit!

          **Macros (Approximate, without toppings):**
          - Calories: 240 kcal
          - Protein: 45g
          - Carbs: 8g
          - Fat: 2g
        `
      },
      {
        title: 'Sheet Pan Sausage & Peppers (4 Servings)',
        body: `
          **Ingredients:**
          - 4 links (400g) Chicken or Turkey Sausage (low-fat)
          - 2 Bell Peppers (various colors), sliced
          - 1 large Onion, sliced
          - 1 tbsp Olive Oil
          - 1 tsp Italian Seasoning, Salt, Pepper.

          **Instructions:**
          1. Preheat oven to 400°F (200°C).
          2. Toss peppers, onion, olive oil, and seasonings on a large baking sheet.
          3. Slice sausage links and spread evenly over the vegetables.
          4. Bake for 25-30 minutes, flipping halfway, until vegetables are tender and sausage is cooked through.

          **Macros (Approximate, per serving):**
          - Calories: 350 kcal
          - Protein: 28g
          - Carbs: 18g
          - Fat: 18g
        `
      },
    ]
  },
  {
    id: 'training',
    title: 'Training Principles',
    icon: 'Dumbbell',
    color: ACCENT_COLOR,
    content: [
      {
        title: 'Progressive Overload: Challenging Yourself Just a Little More',
        body: 'The only way your body changes is if you constantly give it a reason to. **Progressive Overload** simply means finding a way to make your workouts slightly harder over time. If you do the exact same workout with the exact same weight every week, your body has no incentive to build muscle or get stronger.\n\nStrive to apply at least one of these challenges to your main exercises *each week*:\n\n* **Lift Heavier (Load):** Add a small amount of weight (like 2.5 lbs or 1kg) to your barbell or machine. This is one of the fastest ways to get stronger and build density.\n* **Do More Reps (Volume):** Complete one or two extra repetitions on a set.\n* **Do More Sets (Volume):** Add one entire working set to an exercise.\n* **Rest Less (Density):** Complete the same workout but actively cut your rest periods by 15-30 seconds. This improves your overall work capacity.\n* **Slow Down (Time Under Tension):** Deliberately take 3-4 seconds to lower the weight (the eccentric phase). This makes the muscle work harder and feel the tension.'
      },
      {
        title: 'The Central Role of Recovery and Sleep',
        body: 'The workout is the **damage stimulus**, but all the **muscle growth and fat loss occurs during recovery** . Ignoring recovery is the fastest way to feel burnt out and plateau.\n\nYour most powerful recovery tool is **Sleep**.\n* **Hormone Balance:** During deep sleep, your body naturally releases high levels of **Growth Hormone (GH)**—a powerful fat-burning and muscle-repairing hormone. Poor sleep, conversely, increases **Cortisol** (the stress hormone), which breaks down muscle and encourages fat storage.\n* **Nervous System Reset:** Heavy lifting fatigues your brain and **nervous system (CNS)**. Sleep is the only way to fully recover this system so you can lift heavy and stay focused next time. Aim for a non-negotiable **7–9 hours** of high-quality sleep nightly. '
      },
      {
        title: 'Form Over Weight: Mastering Your Technique',
        body: 'The weight on the bar is meaningless if you’re not safely and effectively working the target muscle. **Perfect form is always more important than a heavier weight.**\n\n**Key Techniques for Safety and Strength:**\n* **Bracing Your Core:** Before any heavy lift (Squat, Deadlift, Overhead Press), take a deep breath into your stomach (not your chest) and **brace your core tight, as if someone is about to punch you.** This pressure stabilizes your spine and prevents injury.\n* **Mind-Muscle Connection:** This is simply focusing your attention on the muscle you are trying to work. For example, during a Bicep Curl, concentrate on squeezing the bicep throughout the movement, especially as you lower the weight slowly. The goal is to feel the muscle, not just move the weight.'
      },
      {
        title: 'Understanding Adaptation: Strength vs. Muscle Tone Rep Ranges',
        body: 'You can adjust your rep ranges to focus on different goals:\n\n* **Building Strength (1–6 Reps):** Requires very heavy weights and long rest (3–5 minutes). The goal is teaching your body how to recruit all its muscle fibers for maximum force. Best for core lifts like squats and presses.\n* **Building Muscle Tone/Size (8–15 Reps):** The ideal zone for balancing challenge with volume. This is where most of your training should happen. The shorter rest periods (1–2 minutes) create the **pump** that drives muscle growth and endurance.\n* **Muscular Endurance (15+ Reps):** Requires light weights and short rest periods (30–60 seconds). Focuses on increasing the muscle’s ability to work for long periods (e.g., conditioning circuits).'
      },
      {
        title: 'The Essential Warm-up and Cool-down Protocol',
        body: 'Never skip your warm-up—it’s essential to prevent injury and get your mind ready. A good warm-up is specific to the workout you are about to do.\n\n**Warm-up (10–15 minutes):**\n1.  **General (5 minutes):** Light cardio (walking, cycling) to raise your heart rate and core temperature.\n2.  **Specific (5–10 minutes):** **Dynamic Stretching** (controlled movements like lunges, arm swings). This *activates* the muscles you will use. **Crucially, avoid holding stretches (static) before lifting**—save that for the cool-down.\n\n**Cool-down (5–10 minutes):** After training, use **Static Stretching** (holding stretches for 30–60 seconds) to restore muscle length and help your body relax. This is key for long-term flexibility.'
      },
      {
        title: 'Training Intensity: The "Reps In Reserve" Rule',
        body: 'You need to push hard to get results, but you should rarely train to absolute failure (where you physically can’t move the weight anymore). Training to failure is highly draining on your nervous system and increases injury risk.\n\n**The Rule:** For most of your main working sets, **always stop the set feeling like you could do 1 or 2 more perfect repetitions.**\n* This provides almost all the benefit of training hard without the massive fatigue cost of pushing to absolute failure. This is often called **RIR 1 or 2** (Reps In Reserve).'
      },
      {
        title: 'Optimizing Rest Periods for Quality Sets',
        body: 'The time you spend resting between sets is a key part of your program. Don\'t rest randomly.\n\n* **Long Rest (3–5 Minutes):** **Mandatory** for your heaviest lifts (1–6 reps). This gives your body enough time to fully replenish the quick-energy system that fuels maximal strength, ensuring your next heavy set is just as strong as the last.\n* **Moderate Rest (90–120 Seconds):** Used for muscle-building work (8–15 reps). This partial rest keeps a level of tension and \'pump\' in the muscle, which is great for growth.\n* **Short Rest (30–60 Seconds):** Used for conditioning or very high-rep work. This intentionally keeps you breathless, improving your muscular endurance.'
      },
      {
        title: 'The Power of Compound Lifts (Best Bang for Your Buck)',
        body: 'Compound exercises are movements that work **multiple major muscle groups and multiple joints** at the same time (e.g., Squat, Deadlift, Bench Press, Push-ups).\n\n**Why They Are Essential:**\n* **Maximum Efficiency:** They are the fastest way to build full-body strength and muscle tone because they engage the most total muscle mass at once.\n* **Functional Strength:** They build coordinated, real-world strength and stability that helps you in daily life (e.g., lifting groceries, moving furniture).\n* **Hormonal Boost:** Because they use the largest muscles (legs, back, chest), they trigger a natural and superior release of the anabolic (building) hormones needed for recovery. '
      },
      {
        title: 'The Basics of Deloading: Scheduled Rest',
        body: 'Your body needs a break, even if you feel fine. **Periodization** means cycling periods of hard work with planned recovery to avoid burnout and plateaus. This is often done with a **Deload Week**.\n\nEvery 4–8 weeks of hard training, plan a week where you reduce the weight and the total number of sets you do by 40–60%. This is *not* a rest week—it’s an active recovery week designed to dissipate hidden fatigue in your **nervous system**. You will feel rested, stronger, and more motivated when you start your next training block.'
      },
      {
        title: 'Cardio Integration: HIIT, LISS, and Fat Burning',
        body: 'Cardio is vital for health, heart conditioning, and burning extra calories. The type you choose matters:\n\n* **LISS (Low-Intensity Steady State):** Working at a comfortable pace (you can hold a conversation) for 30–60 minutes (e.g., fast walking, light cycling). This is great for recovery and primarily uses fat for fuel (the **Fat Burning Zone**). This should be your go-to cardio.\n* **HIIT (High-Intensity Interval Training):** Short bursts of maximal effort followed by short rest periods. HIIT significantly improves your **anaerobic fitness**. It creates a powerful **afterburn effect** (your metabolism stays high for hours). **Caution:** HIIT is mentally and physically draining; limit it to 1–2 times per week on non-lifting days to protect your recovery.'
      },
      {
        title: 'Mobility and Range of Motion (ROM)',
        body: 'Mobility is your ability to actively move a joint through its full **Range of Motion (ROM)** with strength and control. Mobility is key to injury prevention and getting the most out of your lifts.\n\nPoor mobility forces your body to compensate, which often stresses vulnerable areas (e.g., tight hips/ankles often cause back pain during squats).\n\nUse your warm-up time to do specific **mobility drills** (band stretches, foam rolling) that target any tight areas. If you can’t safely hit the full ROM for an exercise (like a deep squat), modify the movement until your mobility improves.'
      },
      {
        title: 'Listening to Your Body: Pain vs. Soreness',
        body: 'A crucial skill is knowing the difference between normal soreness and dangerous pain. **Pain is a stop sign; Soreness is a sign of adaptation.**\n\n* **Soreness (DOMS):** A general, dull ache localized in the **middle of the muscle** that peaks 24–48 hours *after* a workout. It feels stiff but usually improves with light movement.\n* **Joint Pain:** Any sharp, shooting, pinching, grinding, or highly localized discomfort that occurs **during the exercise** or at the **joint or tendon insertion points** (e.g., knee cap, low back, shoulder). **If you feel joint pain, stop the exercise immediately. ** Drop the weight, adjust the technique, or replace the exercise entirely. Never "train through" joint or tendon pain.'
      },
      // --- NEW TRAINING ARTICLES (6) ---
      {
        title: 'Optimal Training Frequency (How Often to Hit a Muscle)',
        body: 'For most people aiming for muscle growth (hypertrophy), hitting each major muscle group **2 to 3 times per week** is optimal. Training frequency is about balancing the stimulus (the workout) with recovery time.\n\n* **Why 2-3x?** Research shows that protein synthesis (the process of muscle repair/growth) spikes for about 24–48 hours after a tough workout. Training a muscle too frequently (e.g., 5-6 times per week) can lead to insufficient recovery and overuse injuries.\n* **Lower Frequency (1x/week):** This is generally less effective for muscle growth because it leaves too many recovery days on the table. It\'s better suited for advanced strength athletes with massive volume.\n\n**Strategy:** Use a **Full Body** (3x/week) or **Upper/Lower Split** (4x/week) to naturally hit muscles multiple times.'
      },
      {
        title: 'Full Body vs. Split Routines (Choosing Your Structure)',
        body: 'The best routine is the one you can stick to consistently. Both **Full Body** and **Body Part Splits** (e.g., Chest/Tri, Back/Bi) can be effective.\n\n* **Full Body (3x/week):** Excellent for beginners and those short on time. It is highly efficient, stimulates all major muscles every session, and provides high frequency. **Drawback:** Total volume per muscle group is lower per session.\n* **Upper/Lower Split (4x/week):** Ideal for intermediate lifters. Dedicates entire sessions to pushing or pulling movements (upper) or squat/hinge patterns (lower). **Advantage:** Allows for higher volume and intensity per muscle group while maintaining good frequency.\n* **Body Part Split (5-6x/week):** Only recommended for advanced bodybuilders. High frequency is hard to maintain and can lead to burnout for most people.'
      },
      {
        title: 'The Importance of Anti-Rotation Core Strength',
        body: 'Core strength isn\'t just about visible abs; it\'s about **stability**. Your core\'s primary job is to prevent unwanted movement, which keeps your spine safe and allows your limbs to generate maximum force.\n\n**Anti-Rotation** exercises (e.g., Pallof Press) and **Anti-Extension** exercises (e.g., Plank variations) are arguably more important than basic crunches. They train the core to stay rigid and prevent twisting or arching under load. A weak, unstable core is often the bottleneck that limits your deadlift, squat, and overhead press strength.'
      },
      {
        title: 'Harnessing Eccentric Training (The Lowering Phase)',
        body: 'The **Eccentric Phase** (or "negative") is when the muscle is lengthening under tension—for example, lowering the bar during a bench press or squat. This phase is responsible for most muscle damage (the good kind that promotes growth).\n\n**The Strategy:** Deliberately slow down the eccentric phase of your lifts to **3–4 seconds** (e.g., Squat down slowly, or lower a pull-up slowly). The eccentric phase allows you to handle more weight and creates greater tension, which is a powerful driver for both strength and size.'
      },
      {
        title: 'The Rule of Two Pulls for Every Push',
        body: 'Many lifters prioritize "mirror muscles" (chest, biceps) and neglect their back, leading to strength imbalances, rounded shoulders, and potential shoulder issues. The goal is shoulder health and better posture.\n\n**The Ratio:** Aim to incorporate **two pulling movements (rows, pull-downs, face pulls)** for every **one pushing movement (presses, push-ups)** in your overall program volume. This balances the strength around the shoulder girdle, pulls the shoulders back, and helps counteract the effects of sitting at a desk all day.'
      },
      {
        title: 'Understanding Time Under Tension (TUT)',
        body: '**Time Under Tension (TUT)** is the total amount of time a muscle is working during a set. Manipulating the speed of your repetitions is a simple way to increase TUT without increasing the weight.\n\n**Rep Tempo:** When a plan calls for a tempo like **3-1-1**, it means:\n* **3:** The lowering (eccentric) phase takes 3 seconds.\n* **1:** A brief 1-second pause at the bottom (great for building strength out of a weak position).\n* **1:** The lifting (concentric) phase takes 1 second.\n\nHigh TUT is extremely effective for muscle growth, as it increases the **metabolic stress** within the muscle.'
      },
    ]
  },
  {
    id: 'mindset',
    title: 'Habits & Mindset',
    icon: 'Zap',
    color: 'text-gray-700',
    content: [
      {
        title: 'SMART Goals: Making Your Wishes Actionable',
        body: 'Wishing for a goal is not enough—you need a clear roadmap. Goals must be **SMART** to provide clarity and keep you on track:\n\n* **S**pecific: "Lose 10 lbs" vs. "Feel better."\n* **M**easurable: Track progress with numbers (weight, reps, body measurements).\n* **A**chievable: Challenging but realistic for your current life.\n* **R**elevant: Aligns with your deep reasons for wanting to change.\n* **T**ime-bound: Set a specific deadline.\n\n**Focus on the Daily Process:** While the outcome (e.g., "Lose 20 lbs") is the destination, your daily focus should be on the **process** (e.g., "Hit my protein goal today," or "Get my 8,000 steps in"). You control the process; the outcome is the reward for following it.'
      },
      {
        title: 'Identity-Based Habits: Who You Are Becoming',
        body: 'Sustainable change happens when you stop trying to just change your results and instead focus on changing **who you believe you are (your Identity)**. This is a subtle but powerful psychological shift.\n\n* **Old Focus (Outcome):** "I want to lose weight."\n* **New Focus (Identity):** "**I am a healthy person who prioritizes movement and good fuel.**"\n\nWhen faced with a difficult choice (hitting snooze vs. working out), ask yourself: *"What would the person I want to become do right now?"* This makes good habits a reflection of your personality, not just a temporary chore.'
      },
      {
        title: 'Setting Up Your Success Zone (Environmental Design)',
        body: 'Success is less about willpower and more about **making the healthy choice the easiest choice** . You need to design your environment to work for you, not against you.\n\n* **Make it Obvious & Easy:** Lay your gym clothes out next to your bed. Put your protein powder and shaker cup where you will trip over them. Pre-portion snacks so they are ready to grab.\n* **Make it Difficult:** Store tempting foods (junk food, candy) in a hard-to-reach spot, in an opaque container, or, ideally, don’t bring them home at all. Adding just a few seconds of effort to a bad habit can be enough to stop it.'
      },
      {
        title: 'Stress and Fat Loss: The Cortisol Connection',
        body: 'High levels of psychological stress actively disrupt your fat loss efforts. When you are stressed, your body releases high amounts of the hormone **Cortisol**.\n\nChronic (long-term) high Cortisol levels do two things that harm weight loss:\n1. **Stores Fat:** It encourages the storage of fat, particularly around the abdomen/belly area.\n2. **Increases Cravings:** It messes up your hunger hormones, causing persistent cravings for sugary and high-fat "comfort" foods.\n\n**The takeaway:** Stress management (meditation, walking, good sleep) is not optional—it\'s a fundamental tool for metabolic success.'
      },
      {
        title: 'Reframing Setbacks: The Growth Mindset',
        body: 'Everyone slips up. The key is how you respond. Adopt a **Growth Mindset**:\n\n* **Instead of a Fixed Mindset:** "I missed two workouts this week, so I\'m a failure and should quit."\n* **Use a Growth Mindset:** "I missed two workouts, but I learned that my Tuesday/Thursday schedule is too busy. This is **feedback** telling me I need to adjust my plan for next week."\n\nTreat setbacks not as personal failings, but as **data points** that tell you your strategy needs adjusting. Your ability to learn and adjust is the measure of your success, not perfection.'
      },
      {
        title: 'Non-Scale Victories (NSVs): Tracking Real Progress',
        body: 'The scale is often misleading due to daily fluctuations in water, sodium, and carb intake. Don\'t let a fluctuating number hijack your mood or motivation. \n\nFocus on celebrating **Non-Scale Victories (NSVs)**, which are better signs of real body change:\n* **Performance:** Hitting a new personal best on a lift, walking farther than last month, or feeling stronger in daily tasks.\n* **Body Composition:** Clothes fitting loosely, noticing more muscle shape, better posture.\n* **Health & Mood:** Consistent high energy, sleeping through the night, having better focus at work.\n\nThese victories confirm that your new **Identity** is taking hold.'
      },
      {
        title: 'Habit Stacking: Linking New Habits to Old Ones',
        body: 'Making a new habit stick is all about making it automatic. **Habit Stacking** links a new desired action to an old, established action to use the existing momentum.\n\n**The Simple Formula:** *After [Current Habit], I will [New Habit].*\n\n* **Example:** "After I pour my morning coffee (Current Habit), I will immediately take my vitamins and supplements (New Habit)."\n* **Example:** "After I finish eating dinner (Current Habit), I will immediately load the dishwasher and pack my gym bag for the morning (New Habit)."\n\nThis bypasses the need for willpower because the trigger is already automatic.'
      },
      {
        title: 'Finding Your Deep "Why" (Intrinsic Motivation)',
        body: 'The social environment—parties, dinners, or casual meetings—is often the biggest hurdle to maintaining habits. Dealing with pressure to eat or drink outside your plan is less about what you *say* and more about your internal **confidence** in your choices.\n\n1. **Reframing Your Choices:** Your healthy habits aren\'t a punishment; they are a **priority**. View your food choices as fuel that supports your performance, energy, and mental clarity. When you internalize this, your decisions feel less like "dieting" and more like **self-care**.\n2. **Boundary Confidence:** The key to a non-defensive response is brevity and finality. You don\'t owe anyone a long explanation for your decisions. A simple, confident "No, thank you, I\'m good" or "I\'m going to pass on that one today" is usually enough. People respect clear boundaries, and being secure in your "why" makes the interaction quick and easy.\n3. **The Compromise Strategy (80/20):** If you want to participate without completely derailing your goals, practice moderation. Focus on enjoying the social context and connection. If you choose to have a treat, decide on the amount beforehand (e.g., a few bites of dessert, one small appetizer). This maintains flexibility and prevents the "all-or-nothing" guilt cycle.\n4. **Identity Reinforcement:** Every time you successfully navigate social pressure, you reinforce your new **Identity** as a person who is committed to their health. This builds confidence and makes the next social situation easier.'
      },
      {
        title: 'Mastering Sleep Hygiene for Recovery',
        body: 'Sleep is the most effective form of recovery you have. It\'s where your body repairs muscle and balances all the hormones that control hunger, stress, and fat storage. Poor sleep is a massive metabolic disruptor.\n\n**Actionable Sleep Hygiene:**\n* **The 1-Hour Wind Down:** Stop all work and put away phones/tablets/TV (blue light sources) at least 60 minutes before bed. Blue light blocks the sleep hormone **Melatonin**.\n* **The Cool Rule:** Keep your bedroom cool (ideally 60–67°F or 15–19°C) as your body naturally lowers its temperature to fall asleep.\n* **Consistency:** Go to bed and wake up at roughly the same time every day, even on weekends, to set your body\'s internal clock (**Circadian Rhythm**).'
      },
      // --- NEW MINDSET ARTICLES (6) ---
      {
        title: 'The Power of Accountability and Feedback',
        body: 'Consistency rarely happens in a vacuum. **Accountability**—whether to a coach, a partner, or a group—is a key predictor of success, especially when motivation dips.\n\n* **External:** Knowing you have to check in with your coach or log your workout creates a powerful sense of obligation that overcomes inertia.\n* **Internal:** Regularly reviewing your own data (food logs, weight, lift performance) provides **objective feedback**. This feedback is crucial for making informed adjustments, rather than relying on guesswork or emotion.\n\n**Strategy:** Use the check-in process to be brutally honest, not just with your coach, but with yourself, about where you succeeded and where you stumbled.'
      },
      {
        title: 'Dealing with the Plateau: When Progress Stops',
        body: 'A **plateau** is simply your body telling you it has fully adapted to your current stimulus. It’s normal, but frustrating. To break it, you must change the variables.\n\n**Common Plateau Breakers:**\n1. **Increase Intensity/Volume:** Apply a more aggressive form of **Progressive Overload** (e.g., increase the weight by 5% or add a new working set).\n2. **Take a Deload:** Sometimes, a plateau is caused by excessive fatigue (**CNS fatigue**). A scheduled deload week (reducing volume/intensity) can allow the body to recover fully and come back stronger.\n3. **Change Exercise Selection:** Replace compound movements with variations (e.g., switch from barbell squat to pause squat) to hit the muscle in a new way.\n4. **Re-evaluate Nutrition:** Are you truly tracking accurately? Re-check portion sizes and caloric intake, as small deviations can halt progress.'
      },
      {
        title: 'Motivation is Overrated: Discipline is the Key',
        body: 'Motivation is a temporary emotion that should not be relied upon. Relying on it is a guarantee of inconsistency. **Discipline** is the ability to do what needs to be done, even when you don\'t feel like it.\n\n* **Motivation:** Waiting for the feeling of *wanting* to workout.\n* **Discipline:** Working out because the plan requires it, regardless of mood.\n\n**Action:** Focus on **committing to the minimum viable action** (MVA). If you feel unmotivated, commit to just putting on your gym clothes or doing a 10-minute warm-up. Often, starting the MVA is enough to build the momentum needed to finish the whole task.'
      },
      {
        title: 'Visualizing Success (Mental Repetition)',
        body: 'Elite athletes use **visualization** to prime their nervous system for performance. You can too. Mental practice is a powerful tool to build confidence and coordination.\n\n**How to Visualize:** Before a heavy lift, close your eyes and mentally run through the lift:\n1. **The Setup:** Feel the weight in your hands, the brace in your core, and the position of your feet.\n2. **The Execution:** Visualize yourself moving the weight with perfect, fast technique.\n3. **The Success:** Feel the moment of completion and the relief of a successful set.\n\nDoing this for 30–60 seconds before an important set can improve your focus and confidence, making the movement feel more natural.'
      },
      {
        title: 'Mindfulness in Eating: Slowing Down for Satiety',
        body: 'In our fast-paced world, most people eat quickly while distracted (watching TV, scrolling). This disconnects the stomach from the brain, massively reducing feelings of fullness.\n\n**Mindful Eating Techniques:**\n1. **Put the Fork Down:** Take a 3-second pause between every bite. This forces you to slow the pace.\n2. **Chew Thoroughly:** Chew food until it is almost liquid before swallowing.\n3. **Eliminate Distractions:** Turn off the TV, put the phone in another room, and focus only on the taste, smell, and texture of the food.\n\n**Result:** Eating mindfully allows your hunger hormones (like **Leptin**) enough time to signal the brain that you are full, leading to natural calorie reduction.'
      },
      {
        title: 'Managing the All-or-Nothing Trap',
        body: 'The **"All-or-Nothing"** mindset is the single biggest destroyer of long-term progress. It says: *"If I can\'t follow my diet 100% perfectly, I might as well give up and wait for Monday."*\n\n**The Reality:** Fitness is a spectrum, not a switch. One bad meal, one missed workout, or one cheat day does not ruin a week or a month of consistency. It is simply a moment.\n\n**The Solution:** Focus on **Damage Control**. If you overeat at lunch, your goal for dinner is to get right back to the plan. If you miss Monday’s workout, your goal is to absolutely smash Tuesday’s session. Focus on the next opportunity to make the healthy choice, not dwelling on the mistake.'
      },
    ]
  },
];

// --- UTILITY COMPONENTS ---

const AccordionItem = ({ item, isActive, toggleActive }) => (
  <div className="border-b border-gray-300">
    <button
      className="flex justify-between items-center w-full p-4 text-left font-semibold text-gray-800 hover:bg-gray-100 transition-colors"
      onClick={toggleActive}
      aria-expanded={isActive}
      aria-controls={`content-${item.title.replace(/\s/g, '-')}`}
    >
      <span>{item.title}</span>
      <Icon name="ChevronDown" className={`w-5 h-5 transition-transform ${isActive ? 'transform rotate-180' : ''}`} />
    </button>
    <div
      id={`content-${item.title.replace(/\s/g, '-')}`}
      className={`overflow-hidden transition-all duration-300 ease-in-out ${isActive ? 'max-h-[2200px] opacity-100 p-4 pt-0' : 'max-h-0 opacity-0 p-0'}`}
    >
      {/* RENDERED CONTENT: Changed from <pre> to <div> and uses renderMarkdown for bolding */}
      <div className="text-gray-700 text-sm leading-relaxed whitespace-pre-wrap font-sans bg-gray-50 p-3 rounded-lg border border-gray-200">
        {renderMarkdown(item.body ? item.body.trim() : 'Content loading error or missing.')}
      </div>
    </div>
  </div>
);

// --- HOME PAGE COMPONENT ---
// Updated to accept sections data and navigation handler
const HomeContent = ({ color, sections, onNavigate }) => (
    <div className="space-y-8 p-6 bg-white rounded-xl shadow-lg border-t-8 border-black min-h-[600px] flex flex-col justify-center">
        <header className="text-center">
            {/* ICON CHANGED FROM 'Goal' TO 'Activity' */}
            <Icon name="Activity" className={`w-12 h-12 mx-auto mb-4 ${color}`} />
            <h2 className="text-4xl sm:text-5xl font-extrabold text-gray-900 tracking-tight">
                CLIENT KNOWLEDGE BASE
            </h2>
            {/* NEW TAGLINE INSERTED HERE */}
            <p className="text-lg font-bold mt-2 text-black/80 tracking-widest">
                #FITTER #STRONGER #BETTER
            </p>
            {/* END NEW TAGLINE */}
        </header>

        <div className="prose max-w-none text-gray-600 space-y-6">
            <p className="text-xl leading-relaxed text-center font-medium">
                This is your definitive reference for all the <strong className="font-bold text-gray-900">science-backed strategies</strong> needed to support your training & nutrition, broaden your knowledge, optimize recovery, and make meaningful change to help you achieve your fitness goals.
            </p>

            <h3 className="text-2xl font-bold text-gray-800 border-b pb-2">Master the Fundamentals:</h3>
            
            {/* Clickable Sections Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {sections.map((section) => (
                <button
                  key={section.id}
                  onClick={() => onNavigate(section.id)}
                  className={`p-4 rounded-lg shadow-sm border text-left transition-transform duration-200 hover:scale-[1.01] hover:shadow-lg focus:ring-2 focus:ring-black block w-full h-full
                    ${section.id === 'nutrition' ? 'bg-gray-50 border-gray-200' :
                      section.id === 'training' ? 'bg-gray-50 border-gray-200' :
                      section.id === 'mindset' ? 'bg-gray-50 border-gray-200' :
                      'bg-gray-50 border-gray-200'}
                  `}
                >
                  <Icon name={section.icon} className={`w-6 h-6 inline mr-3 ${ACCENT_COLOR}`} />
                  <strong className={`${ACCENT_COLOR}`}>{section.title}:</strong>
                  <p className="mt-1 text-sm text-gray-600">
                    {section.id === 'nutrition' && 'Master Calorie Balance, Macro breakdowns (Protein, Carbs, Fats), Hydration, and practical strategies for meal prep and eating out.'}
                    {section.id === 'training' && 'The core of growth, covering Progressive Overload, Rep Ranges, proper Form & Technique, Recovery Science (Sleep), and how to periodize your workouts.'}
                    {section.id === 'mindset' && 'Build resilience with SMART Goal Setting, learn to deal with plateaus, design your environment for success, and overcome social pressure.'}
                    {section.id === 'ai-brain' && 'Ask any general fitness question and get immediate, grounded, and evidence-based answers in real-time.'}
                  </p>
                </button>
              ))}
            </div>

            <footer className="mt-8 pt-4 border-t border-gray-200 text-center">
                <p className="text-sm italic text-gray-500">
                    This resource complements your personalized training plan. <strong className="font-bold text-gray-600">Select a category from the sidebar or above to learn more.</strong>
                </p>
            </footer>
        </div>
    </div>
);


// --- AI BRAIN COMPONENT ---

const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

const AICoach = () => {
  const [query, setQuery] = useState('');
  const [response, setResponse] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  
  // STARTING ALL CATEGORIES AS CLOSED (FALSE)
  const [expandedCategories, setExpandedCategories] = useState({
    "Nutrition & Fueling": false,
    "Training Principles": false,
    "Habits & Mindset": false,
  });

  // Reference for the form to submit programmatically
  const formRef = React.useRef(null); 

  // --- CATEGORIZED SUGGESTED QUERIES (NEW) ---
  const nutritionQueries = [
    "How much protein do I actually need to build muscle?",
    "Explain the difference between simple and complex carbs.",
    "What are the benefits of taking creatine?",
    "What are good sources of healthy dietary fats?",
  ];

  const trainingQueries = [
    "Explain progressive overload and give examples.",
    "What are the best mobility drills for squats?",
    "What is the RIR (Reps in Reserve) rule?",
    "Should I do HIIT or LISS cardio for fat loss?",
  ];

  const mindsetQueries = [
    "How does stress (cortisol) affect my fat loss efforts?",
    "Give me an example of habit stacking for my morning routine.",
    "How can I set SMART goals for my fitness journey?",
    "What are non-scale victories (NSVs)?",
  ];

  const categorizedQueries = [
    { title: "Nutrition & Fueling", queries: nutritionQueries },
    { title: "Training Principles", queries: trainingQueries },
    { title: "Habits & Mindset", queries: mindsetQueries },
  ];
  // --- END NEW QUERIES ---

  const systemPrompt = "Act as a comprehensive, knowledge-based Q&A engine focused on fitness, nutrition, and training. Provide generalized, science-backed, and practical advice. Explicitly state that for personalized plans, diagnoses, or critical training decisions, the user must consult their actual personal trainer or medical professional. Keep responses concise and focused, using bullet points or bold text where helpful.";
  const apiKey = ""; // API key is provided by the runtime environment
  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

  const handleSubmit = async (e) => {
    // If e exists and it's a form submit event, prevent default.
    if (e && e.preventDefault) {
      e.preventDefault();
    }
    
    // Use the current query state or the explicit query value for submission
    const queryToSubmit = query.trim() || (e?.target?.query?.value || '').trim();

    if (!queryToSubmit || isLoading) return;

    setResponse(null);
    setError(null);
    setIsLoading(true);

    // Clear input after capturing the query
    setQuery(''); 

    try {
      let result = null;
      let attempt = 0;
      const maxRetries = 5;

      while (attempt < maxRetries) {
        try {
          const payload = {
            contents: [{ parts: [{ text: queryToSubmit }] }],
            tools: [{ "google_search": {} }],
            systemInstruction: {
              parts: [{ text: systemPrompt }]
            },
          };

          const apiResponse = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!apiResponse.ok) {
            throw new Error(`HTTP error! status: ${apiResponse.status}`);
          }

          result = await apiResponse.json();
          break; // Success, exit loop

        } catch (err) {
          attempt++;
          if (attempt >= maxRetries) {
            console.error("Max retries reached. Failed to fetch AI response.", err);
            throw new Error("The AI Brain is currently unavailable. Please try again later.");
          }
          const delay = Math.pow(2, attempt) * 1000;
          await sleep(delay); // Exponential backoff
        }
      }

      const candidate = result?.candidates?.[0];
      const text = candidate?.content?.parts?.[0]?.text || "Sorry, I couldn't generate a helpful response right now. Please try rephrasing your question.";
      
      // Extract grounding sources (citations)
      let sources = [];
      const groundingMetadata = candidate?.groundingMetadata;
      if (groundingMetadata && groundingMetadata.groundingAttributions) {
          sources = groundingMetadata.groundingAttributions
              .map(attribution => ({
                  uri: attribution.web?.uri,
                  title: attribution.web?.title,
              }))
              .filter(source => source.uri && source.title);
      }

      setResponse({ text, sources });

    } catch (err) {
      setError(err.message);
    } finally {
      setIsLoading(false);
    }
  };

  const handleSuggestionClick = (suggestion) => {
    // Set the query state, then trigger a form submission.
    setQuery(suggestion);
    setTimeout(() => {
        // Use the ref to submit the form which ensures the input value (now set via state) is available.
        if (formRef.current) {
            formRef.current.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
        }
    }, 0);
  };
  
  // New function to handle category collapse/expand
  const toggleCategory = (title) => {
    setExpandedCategories(prev => ({
      ...prev,
      [title]: !prev[title]
    }));
  };

  return (
    <div className="flex flex-col h-full min-h-[600px]">
      <div className="mb-6">
        <h2 className="text-3xl sm:text-4xl font-extrabold text-gray-900 flex items-center">
            {/* UPDATED HEADING TEXT and ICON COLOR */}
            <Icon name="Brain" className={`w-8 h-8 mr-3 ${ACCENT_COLOR}`} />
            Gymini: AI Coaching Brain
        </h2>
        <p className="mt-2 text-gray-500 text-lg border-l-4 border-black pl-4 py-2 bg-gray-50/50 rounded-lg">
          Tap into a vast knowledge base. Ask general questions on nutrition, training, and technique. <strong className="font-bold text-gray-900">For specific, tailored advice on your program, diagnoses, or critical training decisions, please message your actual coach.</strong>
        </p>
      </div>

      {/* Response Area */}
      <div className="flex-grow bg-white p-4 rounded-xl shadow-inner mb-6 border border-gray-200">
        {isLoading && (
          <div className="text-center p-8 text-black">
            <Icon name="Loader" className="w-8 h-8 mx-auto animate-spin" />
            <p className="mt-2">Thinking... Accessing the fitness knowledge base.</p>
          </div>
        )}

        {error && (
          <div className="bg-gray-100 border border-black text-black px-4 py-3 rounded-lg relative">
            <p className="font-bold">Error:</p>
            <p className="text-sm">{error}</p>
          </div>
        )}

        {response ? (
          <div className="space-y-4">
            <h3 className="font-bold text-lg text-gray-800">Gymini Response:</h3>
            <p className="whitespace-pre-wrap text-gray-700">{response.text}</p>
            
            {response.sources.length > 0 && (
              <div className="mt-4 pt-3 border-t border-gray-200 text-xs text-gray-500">
                <p className="font-semibold">Sources:</p>
                <ul className="list-disc ml-4 space-y-1 mt-1">
                  {response.sources.slice(0, 3).map((source, index) => (
                    <li key={index} className="truncate">
                      <a href={source.uri} target="_blank" rel="noopener noreferrer" className="text-black hover:underline">{source.title}</a>
                    </li>
                  ))}
                </ul>
              </div>
            )}
            
            <div className="mt-6 p-3 bg-gray-100 border-l-4 border-black rounded-lg text-sm text-gray-800 font-medium shadow-sm">
                <strong className="font-bold text-gray-900">IMPORTANT:</strong> This advice is general knowledge. For personalized programming, check-ins, or questions specific to your training history and medical status, <strong className="font-bold text-gray-900">please message your actual Personal Trainer!</strong>
            </div>
          </div>
        ) : !isLoading && (
          <div className="text-center p-8 text-gray-400">
            <Icon name="Brain" className="w-10 h-10 mx-auto mb-3" />
            <p>Ask a general question about fitness, nutrition, or motivation.</p>
          </div>
        )}
      </div>

      {/* Suggested Queries (NEW CATEGORIZED COLLAPSIBLE LAYOUT) */}
      <div className="mb-4">
        <p className="text-sm font-semibold text-gray-700 mb-2">Popular Searches (Click to Ask):</p>
        <div className="space-y-2 border border-gray-300 rounded-xl overflow-hidden shadow-md">
          {categorizedQueries.map((category) => {
            const isExpanded = expandedCategories[category.title];
            return (
              <div key={category.title} className="border-b border-gray-200 last:border-b-0">
                
                {/* Collapsible Header/Button */}
                <button
                  className="flex justify-between items-center w-full p-3 text-left font-bold text-sm text-gray-800 bg-gray-50 hover:bg-gray-100 transition-colors"
                  onClick={() => toggleCategory(category.title)}
                  aria-expanded={isExpanded}
                >
                  <span>{category.title}</span>
                  <Icon name="ChevronDown" className={`w-4 h-4 transition-transform ${isExpanded ? 'transform rotate-180' : ''}`} />
                </button>
                
                {/* Collapsible Content */}
                <div 
                  className={`overflow-hidden transition-all duration-300 ease-in-out ${isExpanded ? 'max-h-[300px] opacity-100 p-3 pt-1' : 'max-h-0 opacity-0 p-0'}`}
                >
                  <div className="flex flex-wrap gap-2">
                    {category.queries.map((s, index) => (
                      <button
                        key={index}
                        onClick={() => handleSuggestionClick(s)}
                        className={`text-xs px-3 py-1.5 rounded-full border border-gray-300 text-gray-600 bg-white hover:bg-gray-100 transition-colors shadow-sm
                          ${isLoading ? 'opacity-60 cursor-not-allowed' : ''}
                        `}
                        disabled={isLoading}
                      >
                        {s}
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>


      {/* Input Form */}
      <form ref={formRef} onSubmit={handleSubmit} className="flex space-x-3">
        <input
          type="text"
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          placeholder="e.g., 'What is progressive overload?' or 'Best source of complex carbs?'"
          className="flex-grow p-3 border border-gray-400 rounded-xl focus:ring-2 focus:ring-black focus:border-black transition shadow-sm"
          disabled={isLoading}
        />
        <button
          type="submit"
          className={`p-3 rounded-xl text-white transition duration-200 shadow-md ${isLoading ? 'bg-gray-500' : 'bg-black hover:bg-gray-800'}`}
          disabled={isLoading}
        >
          <Icon name="Send" className="w-6 h-6" />
        </button>
      </form>
    </div>
  );
};


// --- MAIN APP COMPONENT ---

const App = () => {
  const [activeSectionId, setActiveSectionId] = useState(knowledgeSections[0].id);
  const [activeAccordion, setActiveAccordion] = useState(null);
  const [isMenuOpen, setIsMenuOpen] = useState(false); // For mobile menu

  const activeSection = knowledgeSections.find(s => s.id === activeSectionId);
  const cardSections = knowledgeSections.filter(s => s.id !== 'home' && s.id !== 'recipes');

  const toggleAccordion = (title) => {
    setActiveAccordion(activeAccordion === title ? null : title);
  };

  // Close mobile menu when a section is selected
  const handleSectionClick = (id) => {
    setActiveSectionId(id);
    setIsMenuOpen(false);
    setActiveAccordion(null); // Reset accordion state when switching sections
  };

  const currentYear = new Date().getFullYear();

  const renderContent = () => {
    if (!activeSection) {
        return (
            <div className="text-center py-20">
              {/* UPDATED ICON REFERENCE */}
              <Icon name="Activity" className="w-12 h-12 mx-auto text-black mb-4" />
              <h2 className="2xl font-bold text-gray-900">Welcome to Your Knowledge Base</h2>
              <p className="text-gray-500 mt-2">Select a category from the menu to start learning.</p>
            </div>
        );
    }

    if (activeSectionId === 'home') {
        return <HomeContent color={activeSection.color} sections={cardSections} onNavigate={handleSectionClick} />;
    }
    
    if (activeSectionId === 'ai-brain') {
        return <AICoach />;
    }
    
    // Render standard knowledge base content
    if (activeSection.content) {
        return (
            <section>
              <div className="flex items-center mb-6">
                <Icon name={activeSection.icon} className={`w-8 h-8 mr-3 ${activeSection.color}`} />
                <h2 className="text-3xl sm:text-4xl font-extrabold text-gray-900">{activeSection.title}</h2>
              </div>
              
              <p className="mb-8 text-gray-500 text-lg border-l-4 border-black pl-4 py-2 bg-gray-50/50 rounded-lg">
                This section contains the fundamental knowledge required for success. Review these topics regularly to build a strong foundation for your performance and fitness journey.
              </p>

              {/* Accordion Content */}
              <div className="space-y-0 border border-gray-300 rounded-xl overflow-hidden shadow-lg">
                {activeSection.content.map((item, index) => (
                  <AccordionItem
                    key={index}
                    item={item}
                    isActive={activeAccordion === item.title}
                    toggleActive={() => toggleAccordion(item.title)}
                  />
                ))}
              </div>
            </section>
        );
    }

    return null;
  };

  return (
    <div className="min-h-screen bg-gray-50 font-sans antialiased">
      <div className="max-w-7xl mx-auto flex flex-col lg:flex-row shadow-xl bg-white rounded-xl my-4 sm:my-8 overflow-hidden">
        
        {/* --- Sidebar / Mobile Menu (Pure Black) --- */}
        <div className="lg:w-1/4 bg-black text-white p-6 shadow-2xl">
          <header className="mb-8 flex justify-between items-center lg:block">
            {/* Branding Block: Updated to new multi-line format */}
            <button
              onClick={() => handleSectionClick('home')}
              className="transition duration-300 text-left w-full"
            >
                <div className="font-black text-white tracking-wider leading-none">
                    {/* Main Title: Largest, Widest Tracking */}
                    <div className="text-2xl sm:text-3xl tracking-widest">COACH CHRIS</div>
                    {/* Secondary Title: Smaller, Tighter Tracking, Slightly Translucent */}
                    <div className="text-xs tracking-tight text-white/80 mt-[-4px] leading-none">CIRCULAR ROOTS COACHING</div>
                    {/* Tagline: Smallest, Tightest Tracking, More Translucent */}
                    <div className="text-[10px] tracking-tighter text-white/60 leading-none">TRAIN UNCNVNTNL</div>
                </div>
            </button>
            
            <button 
              className="lg:hidden p-2 rounded-lg text-gray-200 hover:bg-gray-800 transition"
              onClick={() => setIsMenuOpen(!isMenuOpen)}
              aria-label="Toggle navigation menu"
            >
              {isMenuOpen ? <Icon name="X" className="w-6 h-6" /> : <Icon name="List" className="w-6 h-6" />}
            </button>
          </header>

          {/* Navigation Items (Visible always on desktop, conditionally on mobile) */}
          <nav className={`${isMenuOpen ? 'block' : 'hidden'} lg:block`}>
            <ul className="space-y-3">
              {knowledgeSections.map((section) => (
                <li key={section.id}>
                  <button
                    onClick={() => handleSectionClick(section.id)}
                    className={`flex items-center w-full p-3 rounded-lg text-left transition duration-200 group
                      ${activeSectionId === section.id
                        ? `${ACCENT_CLASS} text-white shadow-lg font-bold`
                        : 'text-gray-300 hover:bg-gray-800 hover:text-white'
                      }`}
                  >
                    <Icon name={section.icon} className={`w-5 h-5 mr-3 
                        ${activeSectionId === section.id || section.id === 'home' || section.id === 'training' || section.id === 'ai-brain' ? 'text-white' : 'text-gray-400'}
                    `} />
                    {section.title}
                  </button>
                </li>
              ))}
            </ul>
          </nav>
        </div>

        {/* --- Main Content Area --- */}
        <main className="lg:w-3/4 p-6 sm:p-10">
          <div className="min-h-[600px] flex flex-col">
            {renderContent()}
          </div>
          
          {/* Removed old footer from here */}

        </main>
      </div>
      
      {/* --- NEW FULL-WIDTH FOOTER --- */}
      <footer className="bg-black py-8 border-t border-white/10 text-white">
          <div className="container mx-auto px-4 sm:px-6 lg:px-8 text-center text-white/50">
              <p className="text-xs mb-4 max-w-3xl mx-auto leading-relaxed text-red-300/80">
                  <strong>General Fitness Disclaimer:</strong> Always consult with a qualified healthcare professional before starting any new fitness program or making changes to your diet. The content on this site and within our programs is for informational purposes only and is not a substitute for medical advice or diagnosis. You engage in physical activity at your own risk.
              </p>
              <p className="text-sm font-semibold mb-1 text-white">
                  &copy; {currentYear} COACH CHRIS | CIRCULAR ROOTS COACHING | TRAIN UNCNVNTNL. All rights reserved
              </p>
              <p className="text-xs text-white/60">Fitter Stronger Better</p>
          </div>
      </footer>
      {/* --- END NEW FOOTER --- */}
      
    </div>
  );
};

export default App;
